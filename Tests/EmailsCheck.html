<iframe src="" frameborder="0"></iframe>
<!doctype html>
<html lang="en">
<!--
This version of the SP Mass deletion tool for users is adapted to work with most versions of SP 2010 and 2013
It uses asynchronous requests
-->

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Mass Deletion 2010-2013</title>
    <script type="text/javascript" src="https://googledrive.com/host/0B05gvY7cupTteG90ejJhVllWZ1k/jquery.js"></script>
    <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.css" />
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://googledrive.com/host/0B05gvY7cupTtTnJfX2I1XzNtdkE/main.css">
    <link rel="stylesheet" href="https://googledrive.com/host/0B05gvY7cupTtTnJfX2I1XzNtdkE/normalize.css">

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.7.1/modernizr.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js"></script>
    <script type="text/javascript" src="https://googledrive.com/host/0B05gvY7cupTteG90ejJhVllWZ1k/jquery.SPServices.min.js"></script>
    <script type="text/javascript" src="https://googledrive.com/host/0B05gvY7cupTteG90ejJhVllWZ1k/sharepointplus.js"></script>
    <script type="text/javascript" src="libraries/2.2/sheetjs.all.min.js"></script>
    <script type="text/javascript" src="libraries/2.2/excelplus-2.2.min.js"></script>
    <script type="text/javascript" src="js/User.js"></script>
    <script type="text/javascript" src="libraries/zeroclipboard-2.2.0/dist/ZeroClipboard.js"></script>
    <style>
        #wrapper{
            width: 70%;
            margin: auto;
        }
        ol{
            border: 1px solid black;

        }
        #valid, #invalid{
            display: inline-block;
            width: 40%;
        }
        p{
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div id="wrapper">
        <div>
            <object id="file-object"></object>
        </div>
        <div id="valid">
            <p>valid users</p>
            <ol id="valid-list">
            </ol>
        </div>
        <div id="invalid">
            <p>Invalid users</p>
            <ol id="invalid-list">
            </ol>
            <button id="d_clip_button"  data-clipboard-target='invalid-list' data-clipboard-text='Default clipboard text from attribute' title='Click me to copy to clipboard.'> Copy selection </button>
        </div>
    </div>
  

    
     
<!--     <textarea cols='30' id='fe_text' rows='3'></textarea> -->
    <ul cols='30' id='fe_text' rows='3'></ul>
   
    <script type="text/javascript">
      //var client = new ZeroClipboard( $('#d_clip_button') );
    </script>
    <script type="text/javascript">

        //$(document).ready(function(){
        	//MassDelete 
            // checks if emails is valid
            
            var ep = new ExcelPlus();
            var SITEENV;
            var userEmails = [];
            var usersInfo = []
            var invalidUsers = [];

            //Gettin the current SP site
            $(document).ready(function() {
                SITEENV = $().SPServices.SPGetCurrentSite();
                $("#copy-invalid-list").click(function(){

                });

                  var clip = new ZeroClipboard($("#d_clip_button"))
            });
            

            // we call openLocal() and when the file is loaded then we want to display its content
            // openLocal() will use the FileAPI if exists, otherwise it will use a Flash object
            ep.openLocal({
                "flashPath": "2.2/swfobject/",
                "labelButton": "Open an Excel file"
            }, function() {
                var arr = ep.selectSheet('MassDelete').readAll();

                // iterate and push emails to userEmails array
                for (var i = 0; i < arr.length; i++) {
                    for (var j = 0; j < arr[i].length; j++) {
                        userEmails.push(arr[i][j]);
                    }
                }
                iterateUsers();
            });

            function iterateUsers() {
                for (var x = 0; x < userEmails.length; x++) {
                    var aName = getUserLogIn(userEmails[x]);
                }
            };

            //User objects constructor

           
        //Method for Getting the user login name

            function getUserLogIn(email) {
                $SP().people(email, {url: SITEENV}, function(p) {
                    if (typeof p === "string") {
                       invalidUsers.push(email);
                       $("#invalid-list").append('<li class="invalid-item">' + email + '</li>');
                       //$('#fe_text').val($('#fe_text').val() + email + '<br />')
                       //$('#fe_text').append('<li>' +email + '</li>')
                    } else{
                        var login = p;
                        console.log(login);

                        var user = new User();
                        user.setName(p.FirstName + " " + p.LastName);
                        user.setLogin(p.AccountName);
                        user.setEmail(p.WorkEmail);
                        user.setPicture(p.PictureURL);

                        usersInfo.push(user);

                        $("#valid-list").append(
                            "<li style='width:200px'>"+ user.getName() +"  <span id='" + user.id +"' class='del' style='cursor:pointer;position:relative;top:1px'>delete</span></li>");

                        $('.del').click(function(e) {
                            //e.preventDefault();
                            $(this).closest('li').remove();
                            usersInfo[parseInt($(this).attr('id'))] = undefined;
                
                        });
                    }

                });
            };


            // $(document).ready(function(){
            //     // $('#d_clip_button').zclip({
            //     //     path:'ZeroClipboard.swf',
            //     //     copy:$('#invalid-list').text()
            //     // });
            // // The link with ID "copy-description" will copy
            // // the text of the paragraph with ID "description"
            //     $('#d_clip_button').zclip({
            //         path:'ZeroClipboard.swf',
            //         copy:function(){return $('#invalid-list').val();}
            //     });
            // // The link with ID "copy-dynamic" will copy the current value
            // // of a dynamically changing input with the ID "dynamic"
            // });
            // //- See more at: http://www.steamdev.com/zclip/#sthash.Hz9Nid3U.dpuf

        	
        
            //One access
            //check group permissions
            var subjectGroups = [];

            $().SPServices({
                operation: "GetGroupCollectionFromWeb",
                webURL: "http://ent261.sharepoint.hp.com/teams/EricssonInt/",
                completefunc: function(xData, Status){
                    $(xData.responseXML).find("Group").each(function(){
                        subjectGroups.push($(this).attr('Name'));
                    });
                }
            });


        //});
    </script>
</body>

</html>
